# .NET Hardened Image Configuration
# Security-hardened .NET runtime and SDK based on Ubuntu hardened base
base: ghcr.io/labrats-work/infra.images/ubuntu-hardened:main
package_manager: apt
multi_arch: true
workdir: /app

tools:
  - name: dotnet-deps
    description: Dependencies for .NET and HTTPS
    method: package
    package: curl wget ca-certificates git

  - name: dotnet-sdk
    description: .NET 8 SDK and runtime via Microsoft package feed
    method: script
    script: |
      . /etc/os-release
      curl -fsSL "https://packages.microsoft.com/config/ubuntu/${VERSION_ID}/packages-microsoft-prod.deb" -o packages-microsoft-prod.deb
      dpkg -i packages-microsoft-prod.deb
      rm packages-microsoft-prod.deb
      apt-get update
      DEBIAN_FRONTEND=noninteractive apt-get install -y --no-install-recommends dotnet-sdk-8.0 aspnetcore-runtime-8.0
      rm -rf /var/lib/apt/lists/*

  - name: dotnet-env
    description: Configure .NET environment
    method: script
    script: |
      echo 'export DOTNET_CLI_TELEMETRY_OPTOUT=1' >> /etc/profile
      echo 'export DOTNET_NOLOGO=1' >> /etc/profile
