# dotnet-hardened Image
# AUTO-GENERATED from tools.yaml - do not edit directly!
#
# Tools included:
#   - dotnet-deps: Dependencies for .NET and HTTPS
#   - dotnet-sdk: .NET 8 SDK and runtime via Microsoft package feed
#   - dotnet-env: Configure .NET environment

FROM --platform=$TARGETPLATFORM ghcr.io/labrats-work/infra.images/ubuntu-hardened:main
ARG TARGETPLATFORM
ARG BUILDPLATFORM

LABEL org.opencontainers.image.authors="tompisula@labrats.work"
LABEL org.opencontainers.image.source="https://github.com/labrats-work/infra.images"
LABEL org.opencontainers.image.description="dotnet-hardened infrastructure image"

# Install packages
RUN apt-get update && \
    apt-get install -y --no-install-recommends curl wget ca-certificates git && \
    rm -rf /var/lib/apt/lists/*

# Install dotnet-sdk (.NET 8 SDK and runtime via Microsoft package feed)
RUN . /etc/os-release && \
    curl -fsSL "https://packages.microsoft.com/config/ubuntu/${VERSION_ID}/packages-microsoft-prod.deb" -o packages-microsoft-prod.deb && \
    dpkg -i packages-microsoft-prod.deb && \
    rm packages-microsoft-prod.deb && \
    apt-get update && \
    DEBIAN_FRONTEND=noninteractive apt-get install -y --no-install-recommends dotnet-sdk-8.0 aspnetcore-runtime-8.0 && \
    rm -rf /var/lib/apt/lists/*

# Install dotnet-env (Configure .NET environment)
RUN echo 'export DOTNET_CLI_TELEMETRY_OPTOUT=1' >> /etc/profile && \
    echo 'export DOTNET_NOLOGO=1' >> /etc/profile

WORKDIR /app

ENTRYPOINT []
CMD []
